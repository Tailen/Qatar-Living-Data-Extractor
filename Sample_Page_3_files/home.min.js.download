var Home = Backbone.View.extend({
  el: $('.home'),

  initialize: function() {
    this.render();
  },

  render: function() {
    this.firstForumBlock();
    this.firstGroupBlock();
    this.cards();
    this.hotelsRestaurant();
  },

  events: {
    'click .js-forums-tab-control': 'toggleForums',
    'click .js-groups-tab-control': 'toggleGroups'
  },

  firstForumBlock: function() {
    $('.js-forums-tab-control').first().addClass('active');
    $('.js-forums-tab-content').first().addClass('active');
  },

  firstGroupBlock: function() {
    $('.js-groups-tab-control').first().addClass('active');
    $('.js-groups-tab-content').first().addClass('active');
  },

  toggleForums: function(el) {
    el.preventDefault();

    var $el = $(el.currentTarget);
    var $tabControls = $('.js-forums-tab-control');
    var $tabContents = $('.js-forums-tab-content');

    $tabControls.removeClass('active');
    $tabContents.removeClass('active');
    $el.addClass('active');

    _.each($tabControls, function(el, i) {
      var $el = $(el);
      var $targetTabContent = $($tabContents[i]);

      if ($el.hasClass('active')) {
        $targetTabContent.addClass('active');
      }
    });
  },

  toggleGroups: function(el) {
    el.preventDefault();

    var $el = $(el.currentTarget);
    var $tabControls = $('.js-groups-tab-control');
    var $tabContents = $('.js-groups-tab-content');

    $tabControls.removeClass('active');
    $tabContents.removeClass('active');
    $el.addClass('active');

    _.each($tabControls, function(el, i) {
      var $el = $(el);
      var $targetTabContent = $($tabContents[i]);

      if ($el.hasClass('active')) {
        $targetTabContent.addClass('active');
      }
    });
  },

  cards: function() {
    var target = {
      '.b-news-n-posts': '.b-news-n-posts--el-single-news',
      '.b-classifieds': '.b-card',
      '.b-hotels-n-reataurants': '.b-card'
    }

    _.each(target, function(block, root) {
      var $cards = $(root).find(block).css('height', 'auto');
      var maxHeightCard = _.max($cards, function(el) { return $(el).height(); });

      _.each($cards, function(el) {
        var $el = $(el);
        var maxHeight = $(maxHeightCard).height();

        $el.height() < maxHeight ? $el.height(maxHeight) : null;
      })
    });
  },

  hotelsRestaurant: function() {
    var $root = $('.b-hotels-n-reataurants');
    var isMobile = window.innerWidth < 768;
    var $target = $root.find('.b-hotels-n-reataurants--el-lead-cover');

    $target.attr('src', $root.data('src-' + (isMobile ? 'mobile' : 'desktop')))
  }
});

var Window = Backbone.View.extend({
  el: window,

  events: {
    'load': function() {
      this.cards();
      this.hotelsRestaurant();
    },

    'resize': function() {
      this.cards();
      this.hotelsRestaurant();
    }
  },

  cards: function() {
    var target = {
      '.b-news-n-posts': '.b-news-n-posts--el-single-news',
      '.b-classifieds': '.b-card',
      '.b-hotels-n-reataurants': '.b-card'
    }

    _.each(target, function(block, root) {
      var $cards = $(root).find(block).css('height', 'auto');
      var maxHeightCard = _.max($cards, function(el) { return $(el).height(); });

      _.each($cards, function(el) {
        var $el = $(el);
        var maxHeight = $(maxHeightCard).height();

        $el.height() < maxHeight ? $el.height(maxHeight) : null;
      })
    });
  },

  hotelsRestaurant: function() {
    var $root = $('.b-hotels-n-reataurants');
    var isMobile = window.innerWidth < 768;
    var $target = $root.find('.b-hotels-n-reataurants--el-lead-cover');

    $target.attr('src', $root.data('src-' + (isMobile ? 'mobile' : 'desktop')))
  }
});

new Home();
new Window();
